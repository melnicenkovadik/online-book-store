# üîß –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º–∏ –∑—ñ —Å–∫—Ä–æ–ª–æ–º - –ü—ñ–¥—Å—É–º–æ–∫

## –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ—Å—Ç—ñ–π–Ω—ñ –ø—ñ–¥—Å–∫–∞–∫—É–≤–∞–Ω–Ω—è —Å–∫—Ä–æ–ª—É –Ω–∞ –≤—Å—ñ—Ö —Å—Ç–æ—Ä—ñ–Ω–∫–∞—Ö —Å–∞–π—Ç—É (40+ —Ä–∞–∑ –∑–∞ –æ–¥–Ω—É —Å–ø—Ä–æ–±—É –ø—Ä–æ—Å–∫—Ä–æ–ª–∏—Ç–∏).

## –ó–Ω–∞–π–¥–µ–Ω—ñ –ø—Ä–∏—á–∏–Ω–∏

### 1. **OptimizedImage.tsx** - –ö–†–ò–¢–ò–ß–ù–ê –ü–†–û–ë–õ–ï–ú–ê! üî•
- `useEffect` –∑ —Ñ—É–Ω–∫—Ü—ñ—î—é `sanitizeImageSrc` –≤ dependencies
- –§—É–Ω–∫—Ü—ñ—è —Å—Ç–≤–æ—Ä—é–≤–∞–ª–∞—Å—è –Ω–∞ –∫–æ–∂–Ω–æ–º—É —Ä–µ–Ω–¥–µ—Ä—ñ ‚Üí –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–∏–π —Ü–∏–∫–ª
- –¶–µ –≤–∏–∫–ª–∏–∫–∞–ª–æ —Ä–µ—Ä–µ–Ω–¥–µ—Ä –ö–û–ñ–ù–û–á –∫–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –æ–¥–Ω–æ—á–∞—Å–Ω–æ

### 2. **useIntersectionObserver.ts**
- –û–±'—î–∫—Ç `options` –≤ dependencies ‚Üí –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–∏–π —Ü–∏–∫–ª
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤—Å—è –Ω—ñ–¥–µ, –∞–ª–µ –º—ñ–≥ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –ø—Ä–æ–±–ª–µ–º–∏

### 3. **SimilarProducts.tsx**
- –ú–∞—Å–∏–≤ `currentProduct.categoryIds` –≤ dependencies ‚Üí –ø–æ—Å—Ç—ñ–π–Ω—ñ —Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏

### 4. **ProductClient.tsx**
- `useEffect` –∑ –ø–æ—Ä–æ–∂–Ω—ñ–º –º–∞—Å–∏–≤–æ–º dependencies, —è–∫–∏–π —Å–∫–∏–¥–∞–≤ —Å—Ç–µ–π—Ç

## –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

### ‚úÖ –í–∏–∫–æ–Ω–∞–Ω–æ:

1. **–°–ø—Ä–æ—â–µ–Ω–æ OptimizedImage.tsx**
   - –í–∏–¥–∞–ª–µ–Ω–æ `useEffect` –ø–æ–≤–Ω—ñ—Å—Ç—é
   - –ó–∞–º—ñ–Ω–µ–Ω–æ `onLoadingComplete` –Ω–∞ `onLoad`
   - –¢–µ–ø–µ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–∞—Ü—é—î —Ç—ñ–ª—å–∫–∏ —á–µ—Ä–µ–∑ callbacks

2. **–í–∏–¥–∞–ª–µ–Ω–æ useIntersectionObserver**
   - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤—Å—è
   - –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ `react-lazy-load-image-component` —è–∫ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É

3. **–í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ dependencies –≤ SimilarProducts**
   - –í–∏–¥–∞–ª–µ–Ω–æ `categoryIds` –∑ dependencies
   - –¢—ñ–ª—å–∫–∏ `currentProduct.id`

4. **–í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ ProductClient**
   - –ó–∞–º—ñ–Ω–µ–Ω–æ `[]` –Ω–∞ `[product.id]` –≤ dependencies

5. **–î–æ–¥–∞–Ω–æ –≥–ª–æ–±–∞–ª—å–Ω—ñ CSS —Ñ—ñ–∫—Å–∏**
   ```css
   html {
     scroll-behavior: auto !important;
     overflow-y: scroll;
   }
   
   body {
     overscroll-behavior: none;
   }
   ```

6. **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è nuqs**
   - `history: "replace"` - –Ω–µ —Å—Ç–≤–æ—Ä—é—î —ñ—Å—Ç–æ—Ä—ñ—é
   - `shallow: true` - –Ω–µ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î —Å—Ç–æ—Ä—ñ–Ω–∫—É
   - `scroll: false` - –Ω–µ –∫—Ä—É—Ç–∏—Ç—å —Å–∫—Ä–æ–ª

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –©–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏:

1. **–ö–∞—Ç–∞–ª–æ–≥** (`/catalog`)
   - –ó–º—ñ–Ω–∞ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ –Ω–µ –º–∞—î –∫—Ä—É—Ç–∏—Ç–∏ —Å–∫—Ä–æ–ª
   - –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è –Ω–µ –º–∞—î –∫—Ä—É—Ç–∏—Ç–∏ —Å–∫—Ä–æ–ª
   - URL –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

2. **–°—Ç–æ—Ä—ñ–Ω–∫–∞ –ø—Ä–æ–¥—É–∫—Ç—É** (`/product/[slug]`)
   - –°–∫—Ä–æ–ª –º–∞—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –ø–ª–∞–≤–Ω–æ
   - –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –º–∞—é—Ç—å –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏—Å—è –±–µ–∑ –ø—ñ–¥—Å–∫–∞–∫—É–≤–∞–Ω—å

3. **–ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞** (`/`)
   - –°–∫—Ä–æ–ª –º–∞—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ
   - –ù–µ–º–∞—î —Å—Ç—Ä–∏–±–∫—ñ–≤ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –∑–æ–±—Ä–∞–∂–µ–Ω—å

### –Ø–∫ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏:

```bash
npm run dev
```

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∑ DevTools (F12)
2. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ `/catalog`
3. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–æ—Å–∫—Ä–æ–ª–∏—Ç–∏ –≤–Ω–∏–∑
4. –ó–º—ñ–Ω—ñ—Ç—å —Ñ—ñ–ª—å—Ç—Ä
5. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ —Å–∫—Ä–æ–ª –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –Ω–∞ –º—ñ—Å—Ü—ñ

### –î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –¥–µ–±–∞–≥—É (—É –∫–æ–Ω—Å–æ–ª—ñ –±—Ä–∞—É–∑–µ—Ä–∞):

```javascript
let scrollCount = 0;
let lastScroll = window.scrollY;

window.addEventListener('scroll', () => {
  const currentScroll = window.scrollY;
  if (Math.abs(currentScroll - lastScroll) > 10) {
    scrollCount++;
    console.log(`Scroll ${scrollCount}: ${lastScroll} ‚Üí ${currentScroll}`);
    if (scrollCount > 10) {
      console.error('üî¥ TOO MANY SCROLLS!');
      console.trace();
    }
  }
  lastScroll = currentScroll;
}, { passive: true });

console.log('üêõ Scroll monitor enabled');
```

## –Ø–∫—â–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤—Å–µ —â–µ —î

### –î–æ–¥–∞—Ç–∫–æ–≤—ñ –∫—Ä–æ–∫–∏:

1. **–û—á–∏—Å—Ç–∏—Ç–∏ –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞**
   ```
   Ctrl+Shift+R (Windows/Linux)
   Cmd+Shift+R (Mac)
   ```

2. **–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ React DevTools Profiler**
   - –í—ñ–¥–∫—Ä–∏–π—Ç–µ React DevTools
   - –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É Profiler
   - –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å Record
   - –ü—Ä–æ—Å–∫—Ä–æ–ª—å—Ç–µ —Å—Ç–æ—Ä—ñ–Ω–∫—É
   - –ó—É–ø–∏–Ω—ñ—Ç—å –∑–∞–ø–∏—Å
   - –ü–æ–¥–∏–≤—ñ—Ç—å—Å—è, —è–∫—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —Ä–µ—Ä–µ–Ω–¥–µ—Ä—è—Ç—å—Å—è

3. **–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ Network tab**
   - –ú–æ–∂–ª–∏–≤–æ —è–∫—ñ—Å—å –∑–∞–ø–∏—Ç–∏ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å —Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏

4. **–¢–∏–º—á–∞—Å–æ–≤–æ –≤—ñ–¥–∫–ª—é—á–∏—Ç–∏ nuqs**
   - –ó–∞–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ `<NuqsAdapter>` –≤ `layout.tsx`
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –ø—Ä–æ–±–ª–µ–º–∞ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è

## –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ –ø–∞–∫–µ—Ç–∏

```bash
npm install nuqs react-lazy-load-image-component
```

## –í–∏–¥–∞–ª–µ–Ω—ñ —Ñ–∞–π–ª–∏

- `src/providers/ScrollRestoration.tsx` - –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤—Å—è
- `src/hooks/useIntersectionObserver.ts` - –∑–∞–º—ñ–Ω–µ–Ω–æ –Ω–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É
- `debug-renders.js` - —Ç–∏–º—á–∞—Å–æ–≤–∏–π —Ñ–∞–π–ª –¥–ª—è –¥–µ–±–∞–≥—É

